@page "/test"
@inject AppDbContext DbContext
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
<PageTitle>金价监控</PageTitle>

@if (_model == null)
{
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">加载中…</span>
        </div>
    </div>
}
else
{
    <div class="container mt-4">
        <div class="card">
            <div class="card-body">
                <EditForm Model="_model"
                          OnValidSubmit="HandleSubmit"
                          FormName="GoldPriceSettingsForm" Enhance="false">
                    <DataAnnotationsValidator />
                    <ValidationSummary class="text-danger mb-3" />
                    <div style="display:none">
                        <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="_model.Id"
                                                                           class="form-control" />
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">上限阈值：</label>
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="_model.UpperThreshold"
                                                                               class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">下限阈值：</label>
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="_model.LowerThreshold"
                                                                               class="form-control" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">更新间隔（秒）：</label>
                            <Microsoft.AspNetCore.Components.Forms.InputNumber @bind-Value="_model.UpdateInterval"
                                                                               class="form-control" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">是否通知：</label>
                            <InputSelect @bind-Value="_model.EnableNotification"
                                         class="form-select">
                                <option value="true" selected="@(_model.EnableNotification ? "selected" : null)">是</option>
                                <option value="false" selected="@(!_model.EnableNotification ? "selected" : null)">否</option>
                            </InputSelect>
                        </div>
                    </div>

                    <!-- 新增：是否通知与通知时段 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">通知时段</label>
                            <div class="d-flex">
                                <InputText type="time"
                                           @bind-Value="_model.NotifyStartTime"
                                           class="form-control me-2" />
                                <InputText type="time"
                                           @bind-Value="_model.NotifyEndTime"
                                           class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">通知地址：</label>
                            <InputText @bind-Value="_model.NotifyPath"
                                       class="form-control" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">通知铃声：</label>
                            <InputSelect @bind-Value="_model.Sound"
                                         class="form-select">
                                <option value="">不响铃</option>
                                @foreach (var sound in Enum.GetValues<Sound>())
                                {
                                    <option value="@sound" selected="@(_model.Sound==sound.ToString() ? "selected" : null)">@sound</option>
                                }
                            </InputSelect>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">
                        保存设置
                    </button>
                </EditForm>
            </div>
        </div>
    </div>
}

@code {
    private enum Sound
    {
        alarm,
        anticipate,
        bell,
        birdsong,
        bloom,
        calypso,
        chime,
        choo,
        descent,
        electronic,
        fanfare,
        glass,
        gotosleep,
        healthnotification,
        horn,
        ladder,
        mailsent,
        minuet,
        multiwayinvitation,
        newmail,
        newsflash,
        noir,
        paymentsuccess,
        shake,
        sherwoodforest,
        silence,
        spell,
        suspense,
        telegraph,
        tipties,
        typewriters,
        update
    }
}
